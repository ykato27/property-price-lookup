# 不動産割安物件発見システム

機械学習を活用して、市場価格より明らかに安く売りに出されている中古マンション物件を発見するシステムです。

## 主要機能

- 🔍 不動産サイトからの物件情報スクレイピング
- 💾 物件データのデータベース保存（1年分蓄積）
- 🤖 機械学習モデルによる適正価格予測
- 📊 価格乖離率による割安物件の抽出
- 🎨 Streamlitによる直感的なUI
- ⚙️ 検索条件のカスタマイズ（エリア、価格乖離率、最低基準価格）

## 対象エリア

- 東京都
- 神奈川県
- 埼玉県
- 千葉県

## 技術構成

- **言語**: Python 3.11+
- **パッケージ管理**: uv
- **UI**: Streamlit
- **データベース**: SQLite3
- **機械学習**: scikit-learn, LightGBM
- **スクレイピング**: BeautifulSoup4, Selenium
- **データ処理**: pandas
- **可視化**: matplotlib, seaborn, plotly

## セットアップ

### 1. uvのインストール

```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

### 2. 依存関係のインストール

```bash
# Python 3.11をインストール
uv python install 3.11

# 依存パッケージをインストール
uv sync
```

### 3. アプリケーション起動

```bash
# Streamlitアプリを起動
uv run streamlit run app.py
```

ブラウザで `http://localhost:8501` にアクセスします。

## 使い方

### 1. データ取得

1. 「データ取得」タブを開く
2. 都道府県と取得件数を選択
3. 「ダミーデータ取得開始」ボタンをクリック

> **注意**: 現在はダミーデータを生成します。実際のスクレイピングは各サイトの利用規約を確認してから実装してください。

### 2. モデル学習

1. 「モデル学習」タブを開く
2. データが100件以上あることを確認
3. 「学習開始」ボタンをクリック
4. 学習完了後、「全物件の価格を予測」ボタンをクリック

### 3. 割安物件検索

1. 「割安物件一覧」タブを開く
2. サイドバーで検索条件を設定
   - 都道府県
   - 最低割引率
   - 最低価格
   - 最大表示件数
3. 条件に一致する割安物件が表示されます

### 4. 統計情報

「統計情報」タブで以下の情報を確認できます：
- 物件総数、予測総数、平均価格
- 都道府県別件数
- サイト別件数
- 価格分布
- 築年数分布

## ディレクトリ構成

```
property-price-lookup/
├── app.py                      # Streamlitメインアプリ
├── pyproject.toml              # uv設定ファイル
├── README.md
├── .gitignore
├── config/
│   └── settings.py             # 設定ファイル
├── data/
│   ├── properties.db           # SQLiteデータベース
│   └── models/
│       ├── latest_model.pkl    # 最新モデル
│       └── model_metadata.json # モデルメタデータ
├── src/
│   ├── scraper/
│   │   ├── base_scraper.py     # スクレイピング基底クラス
│   │   └── suumo_scraper.py    # SUUMOスクレイパー
│   ├── database/
│   │   ├── db_manager.py       # データベース操作
│   │   └── schema.py           # テーブル定義
│   ├── ml/
│   │   ├── feature_engineering.py  # 特徴量生成
│   │   ├── model_trainer.py        # モデル学習
│   │   └── predictor.py            # 予測実行
│   └── utils/
│       └── helpers.py          # 汎用関数
└── tests/                      # テストコード
```

## 機械学習モデル

### 使用アルゴリズム

- LightGBM（勾配ブースティング）

### 主要特徴量

- 基本特徴量: 専有面積、築年数、階数、駅徒歩距離、管理費など
- 派生特徴量: 築年数の2乗、面積あたり管理費、相対的階数など
- カテゴリ特徴量: 都道府県、市区町村、間取り、構造、向きなど

### 評価指標

- RMSE（Root Mean Squared Error）
- MAE（Mean Absolute Error）
- R²スコア
- MAPE（Mean Absolute Percentage Error）

## 注意事項

### 法的リスク

- スクレイピングは各サイトの利用規約に違反する可能性があります
- 商用利用・再配布は行わないでください
- 個人利用の範囲に留めてください
- 過度なアクセスでサーバーに負荷をかけないでください

### 技術的制約

- Selenium使用時はブラウザドライバ（ChromeDriver等）が必要です
- 大量データ取得時はメモリ消費に注意してください
- サイトのHTML構造変更でスクレイピングが動作しなくなる可能性があります

### 精度向上のポイント

- データ量が多いほどモデル精度が向上します（最低100件以上推奨）
- 外れ値（異常に高い/安い物件）は学習前に除去されます
- 定期的なモデル再学習で市場変動に対応できます

## 今後の拡張案

- [ ] 実際のスクレイピング実装（SUUMO, athome, HOMES, 楽天不動産）
- [ ] 物件画像の自動ダウンロード・表示
- [ ] 地図上での物件表示（Folium連携）
- [ ] メール通知機能
- [ ] 価格推移のトラッキング
- [ ] 賃貸物件への対応拡張

## ライセンス

個人利用目的のみ。商用利用禁止。

## 開発者向け

### テスト実行

```bash
uv run pytest tests/
```

### コードフォーマット

```bash
uv run black .
uv run flake8 .
```

## お問い合わせ

問題や質問がある場合は、GitHubのIssuesまでお願いします。
